# نظام إدارة الموارد البشرية

تطبيق ويب شامل لإدارة الموارد البشرية مدعوم بقاعدة بيانات **Supabase** يسمح للمديرين بإدارة الموظفين وتتبع الحضور والانصراف وإدارة الشؤون المالية.

## 🆕 آخر التحديثات
- **إصلاح شامل لمشاكل التواريخ** - حل نهائي لجميع مشاكل التواريخ المقلوبة والمتضاربة
- **إصلاح مشكلة Timezone** - حل مشكلة فرق التوقيت بين UTC والمحلي في سجلات الحضور
- **دالة getLocalDateISO()** - دالة جديدة لضمان الحصول على التاريخ المحلي الصحيح
- **أزرار إصلاح متعددة** - أزرار منفصلة لإصلاح كل نوع من مشاكل التواريخ
- **إصلاح نهائي شامل** - زر واحد لحل جميع مشاكل التواريخ في النظام

## 🚀 آخر التحديثات

### الإصدار الأخير - التصميم العصري الجديد 🎨
- **✅ إعادة تصميم شاملة للواجهة**
  - تصميم عصري متجاوب مستوحى من تطبيقات الجوال الحديثة
  - حذف جميع العناصر المزدحمة والأزرار الزائدة (من 15+ زر إلى 3 أزرار أساسية)
  - تطبيق مبادئ Glass Morphism وBackdrop Blur
  - ألوان متدرجة عصرية وتأثيرات حركية سلسة
     - تحسين كامل لتجربة الجوال مع دعم PWA
   - 📖 **دليل شامل:** [`README-Modern-Design.md`](./README-Modern-Design.md)

### نظام الساعات الإضافية المحدث
- **✅ تم دمج نظام الساعات الإضافية بشكل سلس**
  - الدوام الرسمي: 8:30 صباحاً - 7:00 مساءً (10.5 ساعة)
  - أي عمل بعد 7:00 مساءً يُحسب بمعدل 1.5 ضعف الساعة العادية
  - حساب تلقائي للساعات الفعالة = الساعات العادية + (الساعات الإضافية × 1.5)
  - عرض تفصيلي للساعات الإضافية في البيان المالي المحدث

---

> **🔧 مشكلة البيانات التجريبية؟** اضغط [هنا للحل السريع](README-Data-Fix-Guide.md) - 30 ثانية فقط!
> 
> **📋 البيانات المالية لا تظهر؟** اضغط زر "عرض جميع البيانات المالية" في بوابة الموظف
> 
> **📅 التواريخ تظهر مقلوبة؟** اضغط [هنا للحل](README-Date-Fix-Guide.md) - إصلاح فوري!
> 
> **🎨 جديد: تم توحيد جميع التواريخ!** النظام يستخدم الآن تنسيق DD-MM-YYYY في كل مكان - [التفاصيل](README-Date-Unification-Update.md)

## الميزات الرئيسية

### للمدير:
- **إدارة الموظفين**: إضافة، عرض، وحذف الموظفين
- **تحديد المناصب والرواتب**: تحديد منصب كل موظف وراتبه
- **التقارير الأسبوعية**: إنشاء تقارير مفصلة عن حضور الموظفين مع حساب المستحقات
- **حساب الرواتب**: تقسيم الراتب الشهري على الساعات وحساب المبلغ المستحق أسبوعياً
- **دعم العملات المتعددة**: ريال سعودي، دولار أمريكي، ليرة سورية
- **حساب دقيق للوقت**: تسجيل الوقت بالساعات والدقائق والثواني
- **التحقق من الموقع الجغرافي**: ضمان تسجيل الحضور من مكان العمل فقط
- **إدارة المواقع والفروع**: إضافة وإدارة مواقع فروع الشركة المختلفة
- **إدارة الخصومات والسلف**: إضافة خصومات أو سلف للموظفين مع تسجيل الأسباب وحسابها تلقائياً

### للموظف:
- **تسجيل الحضور والانصراف**: نظام بسيط وسريع لتسجيل أوقات العمل
- **عرض سجل الحضور**: مراجعة سجل الحضور الشخصي
- **عرض الوقت المعمل**: حساب دقيق للوقت بالساعات والدقائق والثواني
- **عرض التاريخ**: تنسيق التاريخ بصيغة DD-MM-YYYY

## كيفية الاستخدام

### تسجيل الدخول الأولي:
- **المدير**: 
  - اسم المستخدم: `admin`
  - كلمة المرور: `admin123`

### إضافة موظفين جدد:
1. سجل دخول كمدير
2. اذهب إلى تبويب "إدارة الموظفين"
3. املأ بيانات الموظف الجديد:
   - الاسم
   - اسم المستخدم وكلمة المرور
   - المنصب والراتب
   - **العملة** (ريال سعودي، دولار أمريكي، ليرة سورية)
4. اضغط "إضافة موظف"

### إعداد مواقع الفروع:
1. سجل دخول كمدير
2. اذهب إلى تبويب "إدارة المواقع"
3. اضغط "إضافة فرع جديد"
4. أدخل اسم الفرع والعنوان
5. **تحديد الموقع الجغرافي**:
   - **الطريقة السهلة**: اضغط "📍 استخدام موقعي الحالي" (عندما تكون في موقع الفرع)
   - **الطريقة اليدوية**: اضغط "✏️ إدخال إحداثيات يدوياً" وأدخل خط العرض والطول
6. حدد نطاق الحضور (50-500 متر)
7. اضغط "إضافة الفرع"

### تسجيل الحضور والانصراف:
1. سجل دخول الموظف باستخدام بياناته
2. **تأكد من وجودك في موقع العمل** (سيظهر لك تأكيد الموقع)
3. اضغط "تسجيل حضور" عند الوصول
4. اضغط "تسجيل انصراف" عند المغادرة

**ملاحظة**: النظام سيتحقق تلقائياً من موقعك الجغرافي ولن يسمح بالتسجيل إلا من داخل نطاق موقع العمل المحدد.

### إنشاء التقارير:
1. سجل دخول كمدير
2. اذهب إلى تبويب "التقارير"
3. اختر الأسبوع المطلوب
4. اضغط "إنشاء التقرير"
5. اضغط "عرض التفاصيل الكاملة" لأي موظف لمشاهدة:
   - تفاصيل الحضور اليومي
   - حساب الراتب بالساعة والمبلغ اليومي
   - المبلغ المستحق للأسبوع
   - الخصومات والسلف المطبقة
6. اضغط "طباعة التقرير" لطباعة تقرير مفصل للموظف

### إدارة الخصومات والسلف:
1. سجل دخول كمدير
2. اذهب إلى تبويب "الشؤون المالية"
3. اختر الموظف ونوع العملية (خصم/سلفة)
4. أدخل المبلغ والسبب
5. اضغط "إضافة"

### طباعة التقارير:
1. بعد عرض تفاصيل أي موظف
2. اضغط زر "طباعة التقرير" (الأخضر)
3. سيتم فتح معاينة الطباعة مع تقرير مُنسق احترافياً
4. التقرير المطبوع يتضمن:
   - رأس الصفحة مع اسم النظام
   - معلومات الموظف والراتب
   - جدول تفصيلي بكل يوم من أيام الأسبوع
   - ملخص الأسبوع مع جميع الحسابات

## نظام العملات المدعومة

يدعم النظام ثلاث عملات رئيسية:

### العملات المتاحة:
- **الريال السعودي (SAR)** - الرمز: ريال
- **الدولار الأمريكي (USD)** - الرمز: $
- **الليرة السورية (SYP)** - الرمز: ل.س

### مميزات نظام العملات:
- **تحديد عملة منفصلة لكل موظف** حسب اتفاقيته
- **عرض موحد للعملة** في جميع التقارير والحسابات
- **حفظ تلقائي للعملة** مع بيانات الموظف
- **دعم كامل في الطباعة** مع رموز العملات الصحيحة

## حساب الوقت بدقة عالية

### نظام الحساب الجديد:
- **تسجيل دقيق**: حتى الثانية الواحدة تُحسب
- **عرض مفصل**: الوقت يظهر بصيغة `HH:MM:SS`
- **حساب تراكمي**: إجمالي الوقت الأسبوعي بدقة
- **تحديث تلقائي**: السجلات القديمة تُحدث تلقائياً

### تنسيق التاريخ الموحد الجديد:
- **صيغة موحدة**: DD-MM-YYYY (ميلادي) في جميع أنحاء التطبيق
- **عرض متسق**: نفس التنسيق في الجداول، التقارير، والطباعة
- **دوال محسنة**: `formatDate()` و `formatDateTime()` للمطورين
- **تجربة أفضل**: لا التباس في التواريخ بعد الآن

## نظام التحقق من الموقع الجغرافي

### الهدف من النظام:
ضمان تسجيل الحضور والانصراف من موقع العمل الفعلي وليس من أي مكان آخر.

### كيف يعمل النظام:

#### للمدير:
1. **إضافة مواقع الفروع**: تحديد الإحداثيات الجغرافية لكل فرع
2. **تحديد نطاق الحضور**: المسافة المسموحة حول كل فرع (50-500 متر)
3. **ربط الموظفين بالفروع**: تحديد فرع عمل كل موظف
4. **اختبار المواقع**: التأكد من صحة إعدادات كل فرع

#### للموظف:
1. **فحص تلقائي للموقع**: عند فتح النظام يتم فحص الموقع الحالي
2. **التحقق عند التسجيل**: النظام يتأكد من الموقع قبل كل تسجيل حضور/انصراف
3. **رسائل تأكيد**: عرض حالة الموقع والمسافة من مكان العمل

### مستويات الأمان:
- **دقة عالية**: استخدام GPS للتحقق من الموقع
- **نطاق مرن**: إمكانية تحديد نطاق مناسب لكل فرع
- **رسائل واضحة**: إعلام الموظف بحالة موقعه ومتطلبات التسجيل

### حالات الاستخدام:
- **موقع صحيح**: ✅ السماح بالتسجيل مع عرض اسم الفرع والمسافة
- **خارج النطاق**: ❌ منع التسجيل مع إظهار المسافة المطلوبة
- **لا يوجد فرع**: ⚠️ تنبيه للمراجعة مع المدير
- **خطأ في تحديد الموقع**: 🔄 طلب المحاولة مرة أخرى

## المتطلبات التقنية

- متصفح ويب حديث يدعم HTML5
- JavaScript مُمكّن
- لا يتطلب خادم ويب (يعمل محلياً)

## حساب الرواتب والمستحقات

يقوم النظام بحساب المستحقات الأسبوعية للموظفين كالتالي:

### معادلة حساب الراتب بالساعة الجديدة:
- **حساب اليوم الواحد**: الراتب الشهري ÷ 6 أيام عمل = حساب اليوم
- **معدل الساعة**: حساب اليوم ÷ 10.5 ساعة = معدل الساعة
- **المستحق الأسبوعي**: (عدد ساعات العمل الفعلية) × (معدل الساعة)

### أمثلة على الحساب:

#### مثال 1: موظف بالريال السعودي
- **راتب شهري**: 500,000 ريال
- **حساب اليوم**: 500,000 ÷ 6 = 83,333.33 ريال
- **معدل الساعة**: 83,333.33 ÷ 10.5 = 7,936.50 ريال
- **عمل**: 40:30:45 (40 ساعة و30 دقيقة و45 ثانية)
- **المستحق**: 40.5125 × 7,936.50 = 321,472.31 ريال أسبوعياً

#### مثال 2: موظف بالدولار الأمريكي
- **راتب شهري**: 5,000 $
- **حساب اليوم**: 5,000 ÷ 6 = 833.33 $
- **معدل الساعة**: 833.33 ÷ 10.5 = 79.37 $
- **عمل**: 42:15:30 (42 ساعة و15 دقيقة و30 ثانية)
- **المستحق**: 42.2583 × 79.37 = 3,354.71 $ أسبوعياً

#### مثال 3: موظف بالليرة السورية
- **راتب شهري**: 2,500,000 ل.س
- **حساب اليوم**: 2,500,000 ÷ 6 = 416,666.67 ل.س
- **معدل الساعة**: 416,666.67 ÷ 10.5 = 39,682.54 ل.س
- **عمل**: 38:45:00 (38 ساعة و45 دقيقة)
- **المستحق**: 38.75 × 39,682.54 = 1,537,698.43 ل.س أسبوعياً

### العوامل المؤثرة على المستحقات:
- **الخصومات**: تُطرح من المستحق الأسبوعي
- **السلف**: تُضاف للمستحق الأسبوعي
- **صافي المبلغ**: المستحق - الخصومات + السلف

### تلوين التقرير:
- **أخضر**: يوم حضور كامل (حضور + انصراف)
- **برتقالي**: حضر ولم ينصرف
- **أحمر**: لم يحضر
- **أزرق فاتح**: يوم الجمعة (عطلة أسبوعية)

### أيام العمل:
- **أيام العمل**: السبت إلى الخميس
- **العطلة الأسبوعية**: يوم الجمعة (يظهر في التقرير كعطلة)

## قاعدة البيانات - Supabase

يدعم النظام قاعدة بيانات **Supabase** (PostgreSQL) لتخزين البيانات بشكل آمن وموثوق:

### مميزات Supabase:
- **قاعدة بيانات PostgreSQL حقيقية** مع Row Level Security
- **مجاني للأبد** - 500 MB تخزين + 2 GB نقل بيانات شهرياً
- **سرعة فائقة** أسرع 10 مرات من حلول التخزين التقليدية
- **Real-time Updates** تحديث فوري للبيانات
- **أمان عالي** مع تشفير البيانات
- **لا قيود على الاستخدام** مثل APIs الأخرى

### إعداد Supabase:
1. اذهب إلى [supabase.com](https://supabase.com) وأنشئ حساب مجاني
2. أنشئ مشروع جديد
3. انسخ **Project URL** و **Anon Key** من Settings → API
4. في النظام، اذهب لتبويب "🚀 قاعدة البيانات"
5. أدخل البيانات واضغط "حفظ الإعدادات"
6. اضغط "اختبار الاتصال" للتأكد
7. انسخ وأجر الكود SQL لإنشاء الجداول
8. اضغط "إعداد الجداول" لإنهاء الإعداد

### مزامنة البيانات:
- **نقل البيانات المحلية**: يمكن نقل البيانات الموجودة من localStorage إلى Supabase
- **مزامنة تلقائية**: جميع العمليات تُحفظ فوراً في قاعدة البيانات
- **دعم هجين**: يعمل مع التخزين المحلي والسحابي

## حفظ البيانات

يدعم النظام طريقتين لحفظ البيانات:
1. **Supabase** (مستحسن): تخزين سحابي آمن وموثوق
2. **localStorage** (احتياطي): تخزين محلي في المتصفح

## الدعم للغة العربية

التطبيق مصمم بالكامل باللغة العربية مع دعم كامل لاتجاه الكتابة من اليمين إلى اليسار (RTL).

## الأمان

- كلمات المرور محفوظة محلياً
- كل موظف يمكنه الوصول فقط لبياناته الشخصية
- المدير فقط يمكنه الوصول لجميع البيانات والتقارير

## التشغيل

1. افتح ملف `index.html` في متصفح الويب
2. سجل دخول باستخدام بيانات المدير المذكورة أعلاه
3. ابدأ بإضافة الموظفين وإدارة النظام

---

## 📚 الأدلة الإضافية

- **[دليل Supabase](README-Supabase.md)** - تكوين قاعدة البيانات السحابية
- **[دليل إصلاح البيانات الحقيقية](README-Data-Fix-Guide.md)** - الحل السريع للبيانات التجريبية
- **[دليل الإصلاح السريع](README-Quick-Fix.md)** - حل مشاكل البيانات المالية
- **[دليل حذف المكرر](README-Duplicate-Fix.md)** - حل مشكلة تكرار البيانات
- **[دليل البيانات الحقيقية مقابل التجريبية](README-Real-vs-Test-Data.md)** - إدارة البيانات الفعلية
- **[دليل استكشاف الأخطاء](README-Troubleshooting.md)** - حل المشاكل التقنية الشائعة
- **[دليل إصلاح مشاكل التواريخ](README-Date-Fix-Guide.md)** - حل مشكلة التواريخ المقلوبة والتواريخ المحفوظة بتنسيق خاطئ
- **[تحديث الأسبوع العربي](README-Arabic-Week-Update.md)** - التحديثات الجديدة للأسبوع العربي وإصلاح التواريخ
- **[توحيد تنسيق التواريخ](README-Date-Unification-Update.md)** - توحيد جميع التواريخ لتنسيق DD-MM-YYYY

---

تم تطوير هذا التطبيق ليكون سهل الاستخدام ومناسب للشركات الصغيرة والمتوسطة التي تحتاج لنظام بسيط وفعال لإدارة حضور الموظفين. 